import{_ as e,M as o,p as c,q as i,R as n,t as s,N as t,a1 as p}from"./framework-5866ffd3.js";const u={},l=n("h1",{id:"pda-终端扫描实现",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#pda-终端扫描实现","aria-hidden":"true"},"#"),s(" PDA 终端扫描实现")],-1),r={href:"https://ask.dcloud.net.cn/article/35044",target:"_blank",rel:"noopener noreferrer"},k=p(`<blockquote><p>以下方法都是非原生方式实现</p></blockquote><h4 id="javascript-获取扫码结果实现" tabindex="-1"><a class="header-anchor" href="#javascript-获取扫码结果实现" aria-hidden="true">#</a> Javascript 获取扫码结果实现</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function-variable function">onkeydown</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//webview不需要兼容ie</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该方法需要判断按键和间隔输入情况，用户可能在扫码的时候有其他按键等误操作，所以不建议用来进行获取扫码结果。</p><h4 id="native-js-监听广播消息实现" tabindex="-1"><a class="header-anchor" href="#native-js-监听广播消息实现" aria-hidden="true">#</a> Native.js 监听广播消息实现</h4>`,5),d={href:"http://ask.dcloud.net.cn/question/45679",target:"_blank",rel:"noopener noreferrer"},v=p(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">plusReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> main <span class="token operator">=</span> plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">runtimeMainActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取activity</span>
  <span class="token keyword">var</span> context <span class="token operator">=</span> plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">importClass</span><span class="token punctuation">(</span><span class="token string">&quot;android.content.Context&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//上下文</span>
  <span class="token keyword">var</span> receiver <span class="token operator">=</span> plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">implements</span><span class="token punctuation">(</span>
    <span class="token string">&quot;io.dcloud.feature.internal.reflect.BroadcastReceiver&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">onReceive</span><span class="token operator">:</span> doReceive<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> IntentFilter <span class="token operator">=</span> plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">importClass</span><span class="token punctuation">(</span><span class="token string">&quot;android.content.IntentFilter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> Intent <span class="token operator">=</span> plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">importClass</span><span class="token punctuation">(</span><span class="token string">&quot;android.content.Intent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  filter<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token string">&quot;com.zkc.scancode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//监听扫描</span>
  main<span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//注册监听</span>

  <span class="token keyword">function</span> <span class="token function">doReceive</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> intent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">importClass</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//通过intent实例引入intent类，方便以后的‘.’操作</span>
    <span class="token keyword">var</span> Number <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Number<span class="token punctuation">)</span><span class="token punctuation">;</span>
    main<span class="token punctuation">.</span><span class="token function">unregisterReceiver</span><span class="token punctuation">(</span>receiver<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//取消监听</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),m={href:"http://www.supoin.com/ProductDetail.aspx?SID=18&PID=23&ID=84#pj",target:"_blank",rel:"noopener noreferrer"},b=p(`<p><img src="https://img.sinea.cn/销邦x8-pdf开发说明.png" alt="开发包截图"></p><p>注意设置内勾选开启扫描，选择输入模式 API：</p><p><img src="https://img.sinea.cn/销邦x8-设备设置界面.png" alt="PDA设置"></p><p>打开开发说明查看参数：</p><p><img src="https://img.sinea.cn/销邦x8-开发包文件夹截图.png" alt="pdf截图"></p><p>代码对应修改如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>···

filter<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token string">&quot;com.android.server.scannerservice.broadcast&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//监听扫描</span>

···

intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">&quot;scannerdata&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//返回结果</span>

···
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>原代码实现的是扫码完成就取消监听这样不符合实际业务（多次扫描），但是不取消监听用同时有打开新的页面，这时会发现之前的页面还在监听扫描，当然在打开新页面的时候进行取消监听，但是当用户从新页面返回之前的页面时又需要重启监听，各种条件判断写出了比较麻烦。</p><p>这里采用的是接受扫描结果时判断是否是当前显示页面，页面关闭后监听的实例也就自动销毁了。首先在打开页面时把页面 id 存储到本地，并且重写 back：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">pageInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> _self <span class="token operator">=</span> plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">currentWebview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;WEBVIEW_ID&quot;</span><span class="token punctuation">,</span> _self<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  mui<span class="token punctuation">.</span><span class="token function-variable function">back</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;WEBVIEW_ID&quot;</span><span class="token punctuation">,</span> _self<span class="token punctuation">.</span><span class="token function">opener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _self<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后判断页面 id：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">scan</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> main <span class="token operator">=</span> plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">runtimeMainActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取activity</span>
  <span class="token keyword">var</span> receiver <span class="token operator">=</span> plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">implements</span><span class="token punctuation">(</span>
    <span class="token string">&quot;io.dcloud.feature.internal.reflect.BroadcastReceiver&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token function-variable function">onReceive</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> intent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//实现onReceiver回调函数</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">currentWebview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>id <span class="token operator">!=</span>
          localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>util<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token constant">WEBVIEW_ID</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">&quot;scannerdata&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> IntentFilter <span class="token operator">=</span> plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">importClass</span><span class="token punctuation">(</span><span class="token string">&quot;android.content.IntentFilter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//引入过滤器</span>
  <span class="token keyword">var</span> Intent <span class="token operator">=</span> plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">importClass</span><span class="token punctuation">(</span><span class="token string">&quot;android.content.Intent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  filter<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token string">&quot;com.android.server.scannerservice.broadcast&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//监听扫码广播</span>
  main<span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//注册监听</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>页面使用：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>mui<span class="token punctuation">.</span><span class="token function">plusReady</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">pageInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">scan</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;扫描结果：&quot;</span> <span class="token operator">+</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>注意：在 HBuilder 控制台没有调试信息，需要在 webview 调试窗口中才能看到打印信息。另外建议在 plusReady 中延迟执行 scan()。</p></blockquote><h3 id="适配霍尼韦尔扫描枪" tabindex="-1"><a class="header-anchor" href="#适配霍尼韦尔扫描枪" aria-hidden="true">#</a> 适配霍尼韦尔扫描枪</h3><p>首先需要在设备上去设置监听的对象名（我这里设置成和销邦设备一样的 com.android.server.scannerservice.broadcast），接受参数的时候再判断一下设备 plus.device.model 进行切换接受返回结果的对象名：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">scan</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> main <span class="token operator">=</span> plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">runtimeMainActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取activity</span>
	<span class="token keyword">var</span> context <span class="token operator">=</span> plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">importClass</span><span class="token punctuation">(</span><span class="token string">&#39;android.content.Context&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//上下文</span>
	<span class="token keyword">var</span> receiver <span class="token operator">=</span> plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">implements</span><span class="token punctuation">(</span><span class="token string">&#39;io.dcloud.feature.internal.reflect.BroadcastReceiver&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token function-variable function">onReceive</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> intent</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//实现onReceiver回调函数</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">currentWebview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>id <span class="token operator">!=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>util<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token constant">WEBVIEW_ID</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
			<span class="token keyword">var</span> _key <span class="token operator">=</span> plus<span class="token punctuation">.</span>device<span class="token punctuation">.</span>model <span class="token operator">==</span> <span class="token string">&#39;EDA50K&#39;</span> <span class="token operator">?</span> <span class="token string">&#39;data&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;scannerdata&#39;</span><span class="token punctuation">;</span>
			<span class="token function">callback</span><span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span>_key<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> IntentFilter <span class="token operator">=</span> plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">importClass</span><span class="token punctuation">(</span><span class="token string">&#39;android.content.IntentFilter&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//引入过滤器</span>
	<span class="token keyword">var</span> Intent <span class="token operator">=</span> plus<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">importClass</span><span class="token punctuation">(</span><span class="token string">&#39;android.content.Intent&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	filter<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token string">&#39;com.android.server.scannerservice.broadcast&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//监听扫码广播</span>
	main<span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//注册监听</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,18);function f(g,w){const a=o("ExternalLinkIcon");return c(),i("div",null,[l,n("ul",null,[n("li",null,[s("文章发布："),n("a",r,[s("DCloud"),t(a)])])]),k,n("p",null,[s("参考 DCloud 论坛 "),n("a",d,[s("回答"),t(a)])]),v,n("p",null,[s("我这里使用的是销邦科技 X8 扫描设备，由于设备不一样导致文章中的代码不能直接使用，需要配置监听的数据才能连接。搜索销邦官网获取对应开发包"),n("a",m,[s("下载"),t(a)])]),b])}const h=e(u,[["render",f],["__file","PDA终端扫描实现.html.vue"]]);export{h as default};
